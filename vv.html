<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>テキストメモ保存＆コピー</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background: #f0f0f0;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      padding: 1.5em;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    textarea {
      width: 100%;
      height: 80px;
      padding: 1em;
      font-size: 16px;
      margin-bottom: 1em;
    }

    button {
      padding: 0.6em 1.2em;
      font-size: 16px;
      margin-right: 1em;
      cursor: pointer;
    }

    #deleteSelectedBtn {
      background: #e74c3c;
      color: white;
      display: none; /* 最初は非表示 */
      margin-bottom: 1em;
    }

    #memoList {
      display: flex;
      flex-wrap: wrap;
      gap: 1em;
      margin-top: 1em;
    }

    .memo {
      background: #f9f9f9;
      padding: 1em;
      border-radius: 6px;
      width: calc(33.333% - 1em);
      box-sizing: border-box;
      position: relative;
      min-height: 150px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .memo p {
      margin: 0 0 1em 0;
      white-space: pre-wrap;
      word-break: break-word;

      /* 3行でカットして「…」表示 */
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .memo-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5em;
      justify-content: space-between;
      align-items: center;
    }

    .memo-checkbox {
      margin-right: 0.5em;
    }

    .memo-header {
      display: flex;
      align-items: center;
      margin-bottom: 0.5em;
    }

    @media (max-width: 768px) {
      .memo {
        width: calc(50% - 1em);
      }
    }

    @media (max-width: 480px) {
      .memo {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>テキストメモ保存＆コピー</h2>
    <textarea id="inputText" placeholder="ここにメモを書いて保存..."></textarea>
    <button onclick="saveMemo()">保存</button>
    <button id="deleteSelectedBtn" onclick="deleteSelectedMemos()">選択したメモを一括削除</button>
    <div id="memoList"></div>
  </div>

  <script>
    let memos = [];
    let selectedIndexes = new Set();

    function loadMemos() {
      const stored = localStorage.getItem('memos');
      if (stored) {
        memos = JSON.parse(stored);
      }
      renderMemos();
      updateDeleteButtonVisibility();
    }

    function saveMemo() {
      const text = document.getElementById('inputText').value.trim();
      if (!text) return;

      memos.push(text);
      localStorage.setItem('memos', JSON.stringify(memos));
      document.getElementById('inputText').value = '';
      renderMemos();
      updateDeleteButtonVisibility();
    }

    function copyMemo(index) {
      navigator.clipboard.writeText(memos[index])
        .then(() => alert('コピーしました'));
    }

    function deleteMemo(index) {
      if (!confirm('このメモを削除しますか？')) return;
      memos.splice(index, 1);
      localStorage.setItem('memos', JSON.stringify(memos));
      selectedIndexes.delete(index);
      renderMemos();
      updateDeleteButtonVisibility();
    }

    function toggleSelectMemo(index, checked) {
      if (checked) {
        selectedIndexes.add(index);
      } else {
        selectedIndexes.delete(index);
      }
      updateDeleteButtonVisibility();
    }

    function updateDeleteButtonVisibility() {
      const btn = document.getElementById('deleteSelectedBtn');
      btn.style.display = selectedIndexes.size > 0 ? 'inline-block' : 'none';
    }

    function deleteSelectedMemos() {
      if (selectedIndexes.size === 0) {
        alert('削除するメモを選択してください。');
        return;
      }
      if (!confirm(`選択した ${selectedIndexes.size} 件のメモを削除しますか？`)) return;

      const sorted = Array.from(selectedIndexes).sort((a,b) => b - a);
      for (const i of sorted) {
        memos.splice(i,1);
      }
      selectedIndexes.clear();
      localStorage.setItem('memos', JSON.stringify(memos));
      renderMemos();
      updateDeleteButtonVisibility();
    }

    function renderMemos() {
      const list = document.getElementById('memoList');
      list.innerHTML = '';

      memos.forEach((memo, index) => {
        const div = document.createElement('div');
        div.className = 'memo';

        const header = document.createElement('div');
        header.className = 'memo-header';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'memo-checkbox';
        checkbox.checked = selectedIndexes.has(index);
        checkbox.onchange = (e) => toggleSelectMemo(index, e.target.checked);

        const p = document.createElement('p');
        p.textContent = memo;

        header.appendChild(checkbox);
        header.appendChild(p);

        const btnContainer = document.createElement('div');
        btnContainer.className = 'memo-buttons';

        const copyBtn = document.createElement('button');
        copyBtn.textContent = 'コピー';
        copyBtn.onclick = () => copyMemo(index);

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = '削除';
        deleteBtn.onclick = () => deleteMemo(index);

        btnContainer.appendChild(copyBtn);
        btnContainer.appendChild(deleteBtn);

        div.appendChild(header);
        div.appendChild(btnContainer);
        list.appendChild(div);
      });
    }

    window.onload = loadMemos;
  </script>
</body>
</html>
